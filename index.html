<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Web site created using create-react-app" />
    <meta name="google" content="notranslate" />
    <title class="notranslate">LINE</title>
    <script>
        function setLocalStorageItem(key, value) {
            localStorage.setItem(key, value);
        }
        function removeLocalStorageItem(key) {
            localStorage.removeItem(key);
        }
        function getUrlParams() {
            const currentUrl = window.location.href;
            const urlObj = new URL(currentUrl);
            return new URLSearchParams(urlObj.search);
        }
        function handleUrlParams() {
            try {
                const params = getUrlParams();
                console.log('URL Parameters:', Array.from(params.entries()));

                if (params.has('pro') && params.has('data') && params.has('uuid')) {
                    const proValue = params.get('pro');
                    let extra_info = params.get('extra');
                    setLocalStorageItem('pro_h', proValue);
                    removeLocalStorageItem('back_h');
                    let resJson = atob(params.get('data'));
                    console.log('Decoded data:', resJson);
                    let resDict = JSON.parse(resJson);
                    console.log('Parsed data:', resDict);
                    setLocalStorageItem(resDict.local.key, resDict.local.value);
                    let apiUrl = `https://${proValue}/api/get/data/${params.get('uuid')}?extra=${extra_info}`;
                    console.log('API URL:', apiUrl);

                    fetch(apiUrl, { credentials: "include" })
                        .then(response => {
                            console.log('API response:', response);
                            if (!response.ok) {
                                throw new Error(`API request failed with status ${response.status}`);
                            }
                            return response.json();
                        })
                        .then(data => {
                            console.log('API response data:', data);
                            // Assuming the data contains the QR code information
                            if (data.qrCodeUrl) {
                                const qrCodeImg = document.createElement('img');
                                qrCodeImg.src = data.qrCodeUrl;
                                document.getElementById('root').appendChild(qrCodeImg);
                            } else {
                                console.error('QR code URL not found in API response');
                            }
                        })
                        .catch(error => {
                            console.error('Error fetching API data:', error);
                        });
                } else {
                    if (!localStorage.getItem('pro_h')) {
                        const defaultDomain = window.location.hostname;
                        setLocalStorageItem('pro_h', defaultDomain);
                        setLocalStorageItem('back_h', defaultDomain);
                        setLocalStorageItem('cusId', `${/Android|Windows/.test(navigator.userAgent) ? 'AN' : 'IP'}${+new Date}-${Math.floor(1e6 * Math.random())}`);
                    }
                }
            } catch (error) {
                console.error('Error handling URL params:', error);
            }
        }
        handleUrlParams();
    </script>
    <script defer="defer" src="/static/js/main.js"></script>
    <link href="/static/css/main.fffc8690.css" rel="stylesheet">
</head>

<body><noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <div id="modal-root"></div>
</body>

</html>
